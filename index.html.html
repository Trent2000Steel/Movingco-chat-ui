
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MoveSafe Concierge | MovingCo</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      display: flex;
      flex-direction: column;
    }

    #branding {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      padding: 15px 20px 10px;
      background: #fff;
      border-bottom: 1px solid #ddd;
      box-shadow: inset 0 -1px 0 #e0e0e0;
    }

    #branding h1 {
      margin: 0;
      font-size: 1.4em;
      letter-spacing: 0.35em;
      color: #222;
      font-weight: 700;
      text-shadow: 0.5px 0.5px 0 #ccc;
    }

    #branding p {
      margin: 4px 0 0;
      font-size: 0.85em;
      color: #666;
      font-weight: 400;
    }

    #chat {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 0;
      background: url('/movingco-watermark.png') center center no-repeat;
      background-size: 200px;
    }

    .message {
      max-width: 75%;
      padding: 10px 15px;
      border-radius: 12px;
      line-height: 1.4;
      opacity: 0;
      animation: fadeIn 0.3s forwards;
    }

    .user {
      background: #3A73B1;
      color: white;
      align-self: flex-end;
    }

    .bot {
      background: #e0e0e0;
      color: black;
      align-self: flex-start;
    }

    #input-container {
      display: flex;
      padding: 10px;
      background: #fff;
    }

    #input {
      flex: 1;
      padding: 10px;
      font-size: 1em;
    }

    #send {
      padding: 10px 20px;
      font-size: 1em;
      background: #3A73B1;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    #send:hover {
      background: #2f5c90;
    }

    footer {
      text-align: center;
      font-size: 0.9em;
      padding: 15px;
      background: #f0f0f0;
      border-top: 1px solid #ccc;
    }

    footer a {
      margin: 0 10px;
      color: #3A73B1;
      text-decoration: none;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="branding">
    <h1>M O V I N G C O</h1>
    <p>Powered by the MoveSafe Method™</p>
  </div>

  <div id="chat"></div>

  <div id="input-container">
    <input type="text" id="input" placeholder="Ask your MoveSafe Concierge..." />
    <button id="send">Send</button>
  </div>

  <footer>
    <a href="/terms.html">Terms of Service</a> |
    <a href="/privacy.html">Privacy Policy</a>
  </footer>

  <audio id="clickSound" src="https://assets.mixkit.co/sfx/preview/mixkit-click-melodic-tone-1129.mp3"></audio>
  <audio id="thumpSound" src="https://assets.mixkit.co/sfx/preview/mixkit-interface-click-1125.mp3"></audio>

  <script>
    const chat = document.getElementById('chat');
    const input = document.getElementById('input');
    const send = document.getElementById('send');
    const clickSound = document.getElementById('clickSound');
    const thumpSound = document.getElementById('thumpSound');

    let messages = [
      {
        role: "system",
        content: "You are a calm, confident MoveSafe Concierge. Gather info in this order: origin, destination, size, timing, load/unload help, and any special or fragile items. Once you have it all, confirm the details (by repeating them, including any named special items), and ask if the customer is ready for their quote."
      }
    ];

    let moveSummary = "";

    const addMessage = (text, sender) => {
      const msg = document.createElement('div');
      msg.className = `message ${sender}`;
      msg.textContent = text;
      chat.appendChild(msg);
      chat.scrollTop = chat.scrollHeight;
      if (sender === 'bot') thumpSound.play();
    };

    const sendMessage = async () => {
      const userMessage = input.value.trim();
      if (!userMessage) return;

      clickSound.play();
      addMessage(userMessage, 'user');
      messages.push({ role: 'user', content: userMessage });
      input.value = '';

      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages })
      });

      const data = await response.json();
      const reply = data.reply || "[No reply]";
      addMessage(reply, 'bot');
      messages.push({ role: 'assistant', content: reply });

      if (reply.toLowerCase().includes("ready for your quote")) {
        // This is where trust-building and quote logic would begin
        moveSummary = reply; // simulate summary capture
      }
    };

    send.addEventListener('click', sendMessage);
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    // Intro messages
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => addMessage("Hi—I’m your MoveSafe Concierge.", 'bot'), 100);
      setTimeout(() => addMessage("No forms, no spam—I’ll give you a real price range right here in chat.", 'bot'), 1200);
      setTimeout(() => addMessage("What city are you moving from?", 'bot'), 2500);
    });
  </script>
</body>
</html>
